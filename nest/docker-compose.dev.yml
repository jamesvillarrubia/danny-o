version: '3.8'

# Development-specific docker-compose
# Usage: docker-compose -f docker-compose.dev.yml up

services:
  app:
    build:
      context: .
      dockerfile: Dockerfile
      target: builder
    container_name: todoist-ai-dev
    environment:
      - NODE_ENV=development
      - RUN_MODE=cli
      - DATABASE_TYPE=sqlite
      - DATABASE_URL=/app/data/tasks.db
      - TODOIST_API_KEY=${TODOIST_API_KEY}
      - CLAUDE_API_KEY=${CLAUDE_API_KEY}
    volumes:
      # Mount source for hot reload
      - ./src:/app/src:ro
      - ./test:/app/test:ro
      - ./data:/app/data
      - ./config:/app/config:ro
      # Persist node_modules
      - node_modules:/app/node_modules
    command: ["pnpm", "start:dev"]
    ports:
      - "3000:3000"
      - "9229:9229"  # Debug port
    restart: unless-stopped
    networks:
      - tasks-network

volumes:
  node_modules:

networks:
  tasks-network:
    driver: bridge

