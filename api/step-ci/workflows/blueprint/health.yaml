# Health Endpoints Blueprint Tests
# 
# Tests all health check endpoints for availability and correct response format.
# Note: Overall health may return 503 if external services (Todoist) are mocked
# but not fully intercepted. Individual probes should always pass.

version: "1.1"
name: Health Blueprint

tests:
  health_overall:
    name: Overall Health Check
    steps:
      - name: GET /health - Returns valid response
        http:
          url: http://localhost:3000/health
          method: GET
          timeout: 5000
          check:
            # Accept 200 (all healthy) or 503 (partial - external mocks may fail)
            status: /^(200|503)$/
            jsonpath:
              # Database and Claude should always be up
              $.info.database.status: up
              $.info.claude.status: up

  health_database:
    name: Database Health Check
    steps:
      - name: GET /health/db - 200 OK
        http:
          url: http://localhost:3000/health/db
          method: GET
          timeout: 5000
          check:
            status: 200

  health_readiness:
    name: Readiness Probe
    steps:
      - name: GET /health/ready - 200 OK
        http:
          url: http://localhost:3000/health/ready
          method: GET
          timeout: 5000
          check:
            status: 200

  health_liveness:
    name: Liveness Probe
    steps:
      - name: GET /health/live - 200 OK
        http:
          url: http://localhost:3000/health/live
          method: GET
          timeout: 5000
          check:
            status: 200

